@page "/"
@page "/{text}"
@using WebSiteEngine.Shared
@using WebSiteEngine.Client.Components 
@inject HttpClient Http

<p>@Text</p>


@foreach (var line in Textiles)
{
    if (line.StartsWith(TextileDocument.Tags.H1))
    {
        <Headline Depth="1">@line.Substring(TextileDocument.Tags.H1.Length)</Headline>
    }
    else if (line.StartsWith(TextileDocument.Tags.H2))
    {
        <Headline Depth="2">@line.Substring(TextileDocument.Tags.H2.Length)</Headline>
    }
    else if (line.StartsWith(TextileDocument.Tags.H3))
    {
        <Headline Depth="3">@line.Substring(TextileDocument.Tags.H3.Length)</Headline>
    }
    else
    {
        <p>@line</p>
    }
}


@code
{
    [Parameter]
    public string Text { get; set; }

    private string Path => (string.IsNullOrEmpty(Text) ? "default" : Text) + ".txt";

    private string[] Textiles { get; set; } = Enumerable.Empty<string>() as string[];

    protected override async Task OnInitializedAsync()
    {
        var textile = await Http.GetFromJsonAsync<TextileDocument>($"api/TextileDocument/{Path}");

        Textiles = textile.Body.Trim('\r').Split("\n");
    }
}